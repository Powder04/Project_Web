<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <title>Chọn Địa chỉ giao hàng</title>
    <style>
      select {
        padding: 5px;
        margin: 10px 0;
        width: 320px;
      }
      label {
        display: block;
        margin-top: 15px;
      }
    </style>
  </head>
  <body>
    <h2>Địa chỉ giao hàng</h2>

    <label for="province">Tỉnh / Thành phố:</label>
    <select id="province">
      <option value="">-- Chọn Tỉnh/TP --</option>
    </select>

    <label for="district">Quận / Huyện:</label>
    <select id="district" disabled>
      <option value="">-- Chọn Quận/Huyện --</option>
    </select>

    <label for="ward">Phường / Xã:</label>
    <select id="ward" disabled>
      <option value="">-- Chọn Phường/Xã --</option>
    </select>

    <script>
      const apiBase = "https://provinces.open-api.vn/api";
      let provinces = [];

      // Khởi tạo dữ liệu khi load trang
      async function initProvinces() {
        const r = await fetch(`${apiBase}/?depth=3`);
        provinces = await r.json();
        const pSel = document.getElementById("province");
        provinces.forEach((p) => {
          const opt = new Option(p.name, p.code);
          pSel.add(opt);
        });
      }

      // Cập nhật danh sách quận/huyện theo tỉnh
      function onProvinceChange() {
        const code = this.value;
        const p = provinces.find((x) => x.code == code);
        const dSel = document.getElementById("district");
        dSel.innerHTML = '<option value="">-- Chọn Quận/Huyện --</option>';
        document.getElementById("ward").innerHTML =
          '<option value="">-- Chọn Phường/Xã --</option>';
        document.getElementById("ward").disabled = true;

        if (p) {
          p.districts.forEach((d) => dSel.add(new Option(d.name, d.code)));
          dSel.disabled = false;
        } else {
          dSel.disabled = true;
        }
      }

      // Cập nhật danh sách phường/xã theo quận/huyện
      function onDistrictChange() {
        const province = provinces.find(
          (p) => p.code == document.getElementById("province").value
        );
        const district = province?.districts.find((d) => d.code == this.value);
        const wSel = document.getElementById("ward");
        wSel.innerHTML = '<option value="">-- Chọn Phường/Xã --</option>';
        if (district?.wards) {
          district.wards.forEach((w) => wSel.add(new Option(w.name, w.code)));
          wSel.disabled = false;
        } else {
          wSel.disabled = true;
        }
      }

      document
        .getElementById("province")
        .addEventListener("change", onProvinceChange);
      document
        .getElementById("district")
        .addEventListener("change", onDistrictChange);

      initProvinces();
    </script>
  </body>
</html>
